<div class="action-btn-group">
    <button class="home-btn" routerLink="/" aria-label="Home">
        <span class="material-icons">home</span>
    </button>
    <button class="logout-btn" (click)="logout()" aria-label="Logout">
        <span class="material-icons">logout</span>
    </button>
</div>
<div class="tabs">
	<button [class.active]="activeTab === 'store'" (click)="activeTab = 'store'">Store Flight</button>
	<button [class.active]="activeTab === 'retrieve'" (click)="activeTab = 'retrieve'">Retrieve Flight</button>
</div>

<div *ngIf="activeTab === 'store'">
	<form [formGroup]="flightForm" (ngSubmit)="storeFlight()" class="flight-form">
		<label>Airline</label>
        <input formControlName="airline" placeholder="e.g. Delta" required />
        <div *ngIf="flightForm.get('airline')?.invalid && flightForm.get('airline')?.touched" class="error">
            <span *ngIf="flightForm.get('airline')?.errors?.['required']">Airline is required.</span>
            <span *ngIf="flightForm.get('airline')?.errors?.['minlength']">Airline name must be at least 2 characters.</span>
            <span *ngIf="flightForm.get('airline')?.errors?.['maxlength']">Airline name must be at most 30 characters.</span>
            <span *ngIf="flightForm.get('airline')?.errors?.['pattern']">Only letters, spaces, and hyphens are allowed.</span>
        </div>

        <label>Arrival Date</label>
        <input type="date" formControlName="arrivalDate" required [min]="today" />
        <div *ngIf="flightForm.get('arrivalDate')?.invalid && flightForm.get('arrivalDate')?.touched" class="error">
        Arrival date is required.
        </div>
        <div *ngIf="flightForm.get('arrivalDate')?.errors?.['pastDate'] && flightForm.get('arrivalDate')?.touched" class="error">
            Arrival date must be today or in the future.
        </div>

        <label>Arrival Time</label>
        <input type="time" formControlName="arrivalTime" required />
        <div *ngIf="flightForm.get('arrivalTime')?.invalid && flightForm.get('arrivalTime')?.touched" class="error">
        Arrival time is required.
        </div>

        <label>Flight Number (last 4 digits)</label>
        <input formControlName="flightNumber" required placeholder="e.g. 1234" />
        <div *ngIf="flightForm.get('flightNumber')?.invalid && flightForm.get('flightNumber')?.touched" class="error">
			<span *ngIf="flightForm.get('flightNumber')?.errors?.['required']">Flight number is required.</span>
			<span *ngIf="flightForm.get('flightNumber')?.errors?.['pattern']">Enter a valid 4-digit flight number.</span>
		</div>


        <label>Number of Guests</label>
        <input type="number" formControlName="numOfGuests" required min="1" />
        <div *ngIf="flightForm.get('numOfGuests')?.invalid && flightForm.get('numOfGuests')?.touched" class="error">
            <span *ngIf="flightForm.get('numOfGuests')?.errors?.['required']">Number of guests is required.</span>
            <span *ngIf="flightForm.get('numOfGuests')?.errors?.['min']">You must enter at least 1 guest.</span>
        </div>

        <label>Comments (optional)</label>
        <input formControlName="comments" />
        <div *ngIf="flightForm.get('comments')?.dirty && flightForm.get('comments')?.errors?.['pattern']" class="error">
            Only letters, spaces, hyphens, periods, and commas are allowed.
        </div>
		<button type="submit">Store Flight</button>
	</form>
</div>

<div *ngIf="activeTab === 'retrieve'">
	<form [formGroup]="retrieveForm" (ngSubmit)="retrieveFlight()" class="retrieve-form">
		<label>Flight Number (last 4 digits)</label>
		<input formControlName="flightNumber" required placeholder="e.g. 1234" />
		<div *ngIf="retrieveForm.get('flightNumber')?.invalid && retrieveForm.get('flightNumber')?.touched" class="error">
			<span *ngIf="retrieveForm.get('flightNumber')?.errors?.['required']">Flight number is required.</span>
			<span *ngIf="retrieveForm.get('flightNumber')?.errors?.['pattern']">Enter a valid 4-digit flight number.</span>
		</div>
		<button type="submit">Retrieve Flight</button>
	</form>
	<div class="flight-card" *ngIf="retrievedFlight">
		<h3>Flight Details</h3>
		<div class="flight-detail"><strong>Airline:</strong> {{ retrievedFlight.airline }}</div>
		<div class="flight-detail"><strong>Arrival Date:</strong> {{ retrievedFlight.arrivalDate }}</div>
		<div class="flight-detail"><strong>Arrival Time:</strong> {{ retrievedFlight.arrivalTime }}</div>
		<div class="flight-detail"><strong>Flight Number:</strong> {{ retrievedFlight.flightNumber }}</div>
		<div class="flight-detail"><strong>Number of Guests:</strong> {{ retrievedFlight.numOfGuests }}</div>
		<div class="flight-detail" *ngIf="retrievedFlight.comments"><strong>Comments:</strong> {{ retrievedFlight.comments }}</div>
	</div>
	<div *ngIf="retrievedFlight === null && searchAttempted" class="no-flight-container">
		<div class="no-flight-icon">
			<span class="material-icons">search_off</span>
		</div>
		<p class="no-flight-text">No flight found</p>
	</div>
</div>
